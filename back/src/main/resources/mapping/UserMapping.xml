<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lansea.wms.mapper.UserMapper">

    <sql id="fieldBase">
        user_name,real_name,email,activated,mobile,phone,role_id
    </sql>
    <sql id="insertField">
        <include refid="fieldBase"></include>,
        password
    </sql>
    <sql id="insertValues">
        #{user.userName} ,#{user.realName} , #{user.email}, #{user.activated} ,
        #{user.mobile} ,#{user.phone} ,#{user.roleId}, #{user.password}
    </sql>

    <!-- 刷新 token -->
    <update id="refreshToken">
        update user
        set token = #{user.token}
        where id = #{user.id}
    </update>

    <!-- 按条件查询用户信息-->
    <select id="selectUserWhere" resultType="com.lansea.wms.model.User">
        select
        u.*, r.name role_name
        from user u
        left join role r on r.id = u.role_id
        <where>
            <if test="form.userName != null and form.userName != '' ">
                user_name like '%${form.userName}%'
            </if>
            <if test="form.realName != null and form.realName != '' ">
                and real_name like '%${form.realName}%'
            </if>
            <if test="form.activated != null and form.activated != 0">
                and activated = #{form.activated}
            </if>
            <if test="form.roleId != null and form.roleId != 0">
                and role_id = #{form.roleId}
            </if>
        </where>
        <if test="sort.sortField != null ">
            order by u.${sort.sortField} ${sort.sortOrder}
        </if>
    </select>

    <!-- 添加用户 -->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into user(<include refid="insertField"></include>,create_time)
        values(<include refid="insertValues"></include>,now())
    </insert>

    <!-- 更新用户信息 -->
    <insert id="update">
        update user
        <set>
            user_name = #{user.userName} ,
            real_name = #{user.realName} ,
            email = #{user.email} ,
            activated = #{user.activated} ,
            mobile = #{user.mobile} ,
            phone = #{user.phone},
            <if test="user.password != null and user.password != ''">
                password = #{user.password}
            </if>
            gender = #{user.gender} ,
            <if test="user.avatar != null and user.avatar != ''">
                avatar = #{user.avatar} ,
            </if>
            role_id = #{user.roleId}
        </set>
        where
        id = #{user.id}
    </insert>


</mapper>